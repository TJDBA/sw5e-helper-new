{{!-- templates/cards/attack-card.hbs - Improved Attack Card --}}
<div class="sw5e-helper-card" data-message-id="{{messageId}}">
  <div class="card-header">
    <div class="weapon-banner">
      <img src="{{weaponImg}}" alt="{{weaponName}}" class="weapon-icon" />
      <div class="weapon-title">
        <span class="name">{{weaponName}}</span>
      </div>
    </div>
    {{#if attackInfo}}
    <span class="info-icon" data-action="show-attack-formula" title="{{localize "SW5EHELPER.AttackFormulaTooltip"}}">ⓘ</span>
    {{/if}}
  </div>
  
  <div class="card-controls">
    <div class="damage-controls">
      {{#unless hideQuickDamage}}
      <button class="quick-btn" data-action="card-quick-damage" title="{{localize "SW5EHELPER.QuickDamage"}}">⚡ Quick</button>
      {{/unless}}
      {{#unless hideModDamage}}
      <button class="quick-btn" data-action="card-mod-damage" title="{{localize "SW5EHELPER.ModDamage"}}">🎲 Modify</button>
      {{/unless}}
    </div>
    
    {{#if isGM}}
    <div class="gm-toolbar">
      {{#unless hideRollAllSaves}}
      <button class="gm-btn" data-action="gm-roll-all-saves">{{localize "SW5EHELPER.RollAllSaves"}}</button>
      {{/unless}}
      <button class="gm-btn" data-action="gm-apply-all-full">{{localize "SW5EHELPER.ApplyAllFull"}}</button>
    </div>
    {{/if}}
    
    <button class="gm-btn toggle-all-btn" data-action="toggle-all">
      {{#if expandedAll}}{{localize "SW5EHELPER.CollapseAll"}}{{else}}{{localize "SW5EHELPER.ExpandAll"}}{{/if}}
    </button>
  </div>

  <div class="targets">
    {{#each targets as |t|}}
    <details class="target-row" data-target-ref="{{t.ref}}">
      <summary class="row-summary" data-action="toggle-row">
        <span class="expand-arrow">▶</span>
        <span class="tgt-name">{{t.name}}</span>
        <span class="tgt-ac">AC {{t.ac}}</span>
        <span class="row-glance">
          {{#if t.attackDisplay}}<span class="hit">🎯 {{t.attackDisplay}}</span>{{/if}}
          {{#if t.damageTotal}}<span class="dmg">💥 {{t.damageTotal}}</span>{{/if}}
          {{#if t.saveDC}}<span class="save">🛡️ {{t.saveAbility}} DC {{t.saveDC}}</span>{{/if}}
        </span>
      </summary>
      <div class="row-body">
        <div class="actions">
          <a class="action-btn" data-action="apply-full" data-target-ref="{{t.ref}}">💯</a>
          <a class="action-btn" data-action="apply-half" data-target-ref="{{t.ref}}">½</a>
          <a class="action-btn" data-action="apply-none" data-target-ref="{{t.ref}}">Ø</a>
          <a class="action-btn" data-action="row-mod-damage" data-target-ref="{{t.ref}}">🎲</a>
        </div>
      </div>
    </details>
    {{/each}}
  </div>

</div>